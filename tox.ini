[tox]
environments =
    py312
    lint

[gh]
python = 3.12

[testenv]
basepython = python3.12
usedevelop = True
whitelist_externals =
    npm
    yarn
    rm
    mkdir
    cp
    mv
    chmod

[testenv:py312]
deps =
    -rrequirements.txt
    pytest>=7.0.0
    pytest-asyncio>=0.20.3
    pytest-cov>=6.1.1
    pytest-mock>=3.14.0
    pytest-xdist>=3.6.1
commands =
    pytest tests/ -v --tb=short

[testenv:lint]
commands =
    black . --check
    isort . --check
    flake8 .
    mypy .
    flake8 mcp tests

[testenv:type-check]
commands =
    mypy mcp tests

[testenv:security]
commands =
    bandit -r mcp tests
    safety check -r requirements.txt

[pytest]
python_files = test_*.py
python_classes = Test*
python_functions = test_*
addopts =
    -v
    --tb=short
    -p no:importlib
    -p no:pytester

markers =
    integration: mark a test as an integration test
    unit: mark a test as a unit test
    security: mark a test as a security test
    monitoring: mark a test as a monitoring test

[coverage:run]
source = mcp
omit =
    tests/*
    */__init__.py
    mcp/core/config.py
    mcp/core/exceptions.py
    mcp/core/middleware.py
    mcp/core/utils.py

[coverage:report]
show_missing = true
skip_covered = true
fail_under = 80

[coverage:html]
directory = tests/reports/coverage

[coverage:xml]
output = tests/reports/coverage/coverage.xml

[coverage:json]
output = tests/reports/coverage/coverage.json

[coverage:term]
show_missing = true
skip_covered = true

[coverage:annotate]
directory = tests/reports/coverage/annotate
